<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4e54c8">
    <meta name="description" content="Aplicación para realizar sorteos aleatorios de nombres con almacenamiento en GitHub.">
    <meta name="keywords" content="sorteo, aleatorio, nombres, random, organizador, GitHub, nube">
    <meta name="author" content="Sorteo App">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Sorteo Aleatorio de Nombres</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Librería de Confeti para la celebración -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Librería SheetJS para leer Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --accent-color: #ffc107;
            --success-color: #198754;
            --danger-color: #dc3545;
            --github-color: #24292e;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* Estilos para modo standalone (PWA) */
        @media all and (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .pwa-install-btn {
                display: none !important;
            }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Animación suave para la lista */
        .list-item-enter {
            animation: slideIn 0.3s ease-out forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilo personalizado para el scrollbar */
        .custom-scrollbar {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c7c7c7; 
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }

        .header-bg {
            background-color: var(--primary-color);
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            position: relative;
            overflow: hidden;
        }

        .winner-badge {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #333;
            font-weight: bold;
        }

        .list-item {
            transition: all 0.2s ease;
        }

        .list-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .result-item {
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .winner-item {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.05) 100%);
            border-left: 5px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
            animation: pulseWinner 2s infinite;
        }

        @keyframes pulseWinner {
            0% { box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4); }
            100% { box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2); }
        }

        .checkbox-custom {
            accent-color: var(--primary-color);
        }
        
        .sort-indicator {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .auto-dismiss-alert {
            animation: slideDown 0.5s ease-out, fadeOut 1s ease-in 4s forwards;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; height: 0; padding: 0; margin: 0; border: 0; overflow: hidden; }
        }

        /* Botón de instalación PWA */
        .pwa-install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        /* Estilos GitHub */
        .github-btn {
            background-color: var(--github-color);
            border-color: var(--github-color);
            color: white;
        }
        
        .github-btn:hover {
            background-color: #000;
            border-color: #000;
            color: white;
        }
        
        .github-badge {
            background-color: var(--github-color);
            color: white;
        }
        
        .list-item-github {
            border-left: 4px solid var(--github-color);
        }
        
        .token-input-container {
            position: relative;
        }
        
        .token-preview {
            font-family: monospace;
            letter-spacing: 1px;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.9em;
        }
        
        /* Modal de listas GitHub */
        .github-list-item {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .github-list-item:hover {
            background-color: rgba(36, 41, 46, 0.05);
            transform: translateX(5px);
        }
        
        .github-list-item.selected {
            background-color: rgba(36, 41, 46, 0.1);
            border-left: 4px solid var(--github-color);
        }
        
        /* Spinner de carga */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        /* Ajustes para móviles */
        @media (max-width: 768px) {
            .glass-effect {
                margin: 10px;
                border-radius: 20px;
            }
            
            .pwa-install-btn {
                bottom: 10px;
                right: 10px;
            }
            
            .btn {
                padding: 10px 15px;
            }
            
            .modal-dialog {
                margin: 10px;
            }
        }
    </style>
</head>
<body class="d-flex align-items-center justify-content-center p-3">

    <!-- Indicador de modo offline -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fa-solid fa-wifi-slash me-2"></i> Estás trabajando sin conexión
    </div>

    <div class="glass-effect w-100 rounded-4 overflow-hidden" style="max-width: 700px;">
        
        <!-- Encabezado -->
        <div class="header-bg p-4 text-center text-white position-relative">
            <div class="position-absolute top-0 start-0 w-100 h-100 opacity-25">
                <i class="fa-solid fa-dice fa-3x position-absolute" style="top: -10px; left: -10px; transform: rotate(12deg);"></i>
                <i class="fa-solid fa-list-ol fa-3x position-absolute" style="bottom: -10px; right: -10px; transform: rotate(-12deg);"></i>
            </div>
            <h1 class="h2 fw-bold position-relative"><i class="fa-solid fa-shuffle me-2"></i>Organizador Aleatorio</h1>
            <p class="mb-0 opacity-75 position-relative">Introduce nombres y genera un orden al azar</p>
            <div class="position-absolute top-0 end-0 mt-2 me-2">
                <span id="appStatus" class="badge bg-success bg-opacity-75">
                    <i class="fa-solid fa-circle me-1" style="font-size: 0.6rem;"></i> Online
                </span>
            </div>
        </div>

        <!-- Cuerpo de la App -->
        <div class="p-4">
            
            <!-- Barra de Herramientas (Importar / Exportar / GitHub) -->
            <div class="mb-4 p-3 bg-light rounded-3 border">
                <div class="row align-items-center">
                    <div class="col-md-6 mb-2 mb-md-0">
                        <!-- Botón Importar -->
                        <div class="d-flex flex-wrap gap-2">
                            <input type="file" id="fileInput" class="d-none" accept=".xlsx, .xls, .json, .txt, .csv">
                            <button onclick="document.getElementById('fileInput').click()" 
                                class="btn btn-outline-primary btn-sm">
                                <i class="fa-solid fa-file-arrow-up me-1"></i> Importar
                            </button>
                            
                            <!-- Botón Configurar GitHub -->
                            <button class="btn btn-outline-dark btn-sm" onclick="showGitHubConfig()">
                                <i class="fa-brands fa-github me-1"></i> GitHub
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <!-- Botones Exportar y Guardar -->
                        <div class="d-flex align-items-center justify-content-end flex-wrap gap-2">
                            <span class="text-muted small fw-bold me-2">Guardar:</span>
                            <div class="btn-group" role="group">
                                <button onclick="exportList('txt')" 
                                    class="btn btn-outline-success btn-sm" title="Descargar como TXT">
                                    .txt
                                </button>
                                <button onclick="exportList('json')" 
                                    class="btn btn-outline-success btn-sm" title="Descargar como JSON">
                                    .json
                                </button>
                            </div>
                            
                            <!-- Botón Guardar en GitHub -->
                            <button id="saveToGitHubBtn" class="btn github-btn btn-sm d-none" onclick="saveToGitHub()">
                                <i class="fa-brands fa-github me-1"></i> Guardar en nube
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Opción para eliminar ganador -->
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input checkbox-custom" type="checkbox" id="eliminarGanadorCheck">
                    <label class="form-check-label" for="eliminarGanadorCheck">
                        <i class="fa-solid fa-user-minus me-1"></i> Eliminar ganador después del sorteo
                    </label>
                    <small class="d-block text-muted mt-1">
                        El nombre del ganador se eliminará automáticamente de la lista para el próximo sorteo.
                    </small>
                </div>
            </div>

            <!-- Sección de Entrada -->
            <div class="mb-4">
                <div class="input-group">
                    <input type="text" id="nameInput" 
                        class="form-control" 
                        placeholder="Escribe un nombre aquí..." autocomplete="off">
                    <button onclick="addName()" 
                        class="btn btn-primary">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
                <div id="duplicateAlert" class="alert alert-warning mt-2 py-2 d-none auto-dismiss-alert">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i>Este nombre ya existe en la lista
                </div>
                <div class="sort-indicator mt-1">
                    <i class="fa-solid fa-sort-alpha-down me-1"></i>Los nombres se ordenan automáticamente alfabéticamente
                </div>
            </div>

            <!-- Contenedor de Listas -->
            <div id="listsContainer">
                
                <!-- Lista de Participantes (Antes del sorteo) -->
                <div id="participantsSection" class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h3 class="h6 fw-bold text-uppercase text-secondary">
                            <i class="fa-solid fa-sort-alpha-down me-1"></i>Participantes (<span id="count">0</span>)
                        </h3>
                        <div class="d-flex align-items-center gap-2">
                            <!-- Botón Cargar desde GitHub -->
                            <button id="loadFromGitHubBtn" class="btn btn-outline-dark btn-sm d-none" onclick="loadFromGitHub()">
                                <i class="fa-brands fa-github me-1"></i> Cargar desde nube
                            </button>
                            <button onclick="clearList()" id="clearBtn" class="btn btn-link text-danger p-0 d-none">
                                <i class="fa-solid fa-trash me-1"></i>Borrar todo
                            </button>
                        </div>
                    </div>
                    
                    <ul id="nameList" class="list-group custom-scrollbar">
                        <li id="emptyState" class="list-group-item text-center text-muted py-4">
                            <i class="fa-solid fa-list-check fa-2x mb-2 d-block"></i>
                            La lista está vacía. ¡Añade nombres o importa un archivo!
                        </li>
                    </ul>
                </div>

                <!-- Botón de Acción Principal -->
                <button onclick="sortNames()" id="sortBtn" disabled
                    class="btn btn-success w-100 py-3 fw-bold mb-4 shadow-sm">
                    <i class="fa-solid fa-play me-2"></i> ¡Sortear Orden!
                </button>

                <!-- Resultados (Ocultos inicialmente) -->
                <div id="resultSection" class="d-none border-top pt-4 mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="h5 fw-bold text-success">
                            <i class="fa-solid fa-trophy me-2"></i>Resultado del Sorteo
                        </h3>
                        <button onclick="resetSort()" class="btn btn-outline-secondary btn-sm">
                            <i class="fa-solid fa-rotate-left me-1"></i> Reiniciar
                        </button>
                    </div>
                    <ul id="resultList" class="list-unstyled">
                        <!-- Los resultados irán aquí -->
                    </ul>
                </div>
            </div>
            
            <!-- Información de la PWA -->
            <div class="mt-4 pt-3 border-top text-center">
                <small class="text-muted">
                    <i class="fa-solid fa-mobile-screen me-1"></i> Instala esta app para usarla offline
                    <button class="btn btn-link btn-sm p-0 ms-1" onclick="showInstallInstructions()">
                        <i class="fa-solid fa-circle-info"></i>
                    </button>
                </small>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-light p-3 text-center text-muted small border-top">
            <span id="versionInfo">v1.1.0 • Sorteo 100% aleatorio</span> • <i class="fa-solid fa-lock text-muted ms-1"></i> Local & Seguro
        </div>
    </div>

    <!-- Botón flotante para instalar PWA -->
    <button id="installButton" class="pwa-install-btn btn btn-primary rounded-circle shadow-lg d-none" 
            style="width: 60px; height: 60px;" title="Instalar aplicación" onclick="showInstallInstructions()">
        <i class="fa-solid fa-download"></i>
    </button>

    <!-- Modal de configuración de GitHub -->
    <div class="modal fade" id="githubConfigModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">
                        <i class="fa-brands fa-github me-2"></i> Configuración de GitHub
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        Configura tu token de GitHub para almacenar listas en la nube. El token se guarda localmente en tu navegador.
                    </div>
                    
                    <div class="mb-3">
                        <label for="githubToken" class="form-label">
                            <strong>Token de GitHub</strong>
                            <small class="text-muted ms-1">(Personal Access Token)</small>
                        </label>
                        <div class="input-group token-input-container">
                            <input type="password" class="form-control" id="githubToken" 
                                   placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                            <button class="btn btn-outline-secondary" type="button" onclick="toggleTokenVisibility()">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                            <input type="file" id="tokenFileInput" class="d-none" accept=".txt">
                            <button class="btn btn-outline-secondary" type="button" onclick="document.getElementById('tokenFileInput').click()">
                                <i class="fa-solid fa-file-import"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>
                                    <a href="https://github.com/settings/tokens" target="_blank" class="text-decoration-none">
                                        <i class="fa-solid fa-external-link me-1"></i> Generar token en GitHub
                                    </a>
                                </span>
                                <span id="tokenPreview" class="token-preview d-none"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="githubUsername" class="form-label">Nombre de usuario de GitHub</label>
                            <input type="text" class="form-control" id="githubUsername" 
                                   placeholder="tu-usuario">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="githubRepo" class="form-label">Repositorio</label>
                            <input type="text" class="form-control" id="githubRepo" 
                                   placeholder="sorteo-listas" value="sorteo-listas">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="githubFolder" class="form-label">Carpeta en el repositorio</label>
                        <input type="text" class="form-control" id="githubFolder" 
                               placeholder="listas" value="listas">
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        <strong>Importante:</strong> El token se guarda localmente en tu navegador. 
                        Asegúrate de que el token tenga permisos de "repo" para poder leer y escribir en el repositorio.
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="saveGitHubConfig()">
                            <i class="fa-solid fa-save me-2"></i> Guardar configuración
                        </button>
                        <button class="btn btn-outline-danger" onclick="clearGitHubConfig()">
                            <i class="fa-solid fa-trash me-2"></i> Eliminar configuración
                        </button>
                    </div>
                    
                    <div class="mt-4">
                        <h6 class="border-bottom pb-2">Estado de la conexión</h6>
                        <div id="githubStatus" class="alert alert-secondary">
                            <i class="fa-solid fa-circle-question me-2"></i>
                            Configura tu token para verificar la conexión.
                        </div>
                        <div class="d-grid">
                            <button class="btn btn-outline-dark" onclick="testGitHubConnection()">
                                <i class="fa-solid fa-plug me-2"></i> Probar conexión con GitHub
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para cargar listas desde GitHub -->
    <div class="modal fade" id="githubLoadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">
                        <i class="fa-brands fa-github me-2"></i> Cargar lista desde GitHub
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <span class="badge github-badge" id="repoInfo">Cargando...</span>
                        </div>
                        <button class="btn btn-outline-dark btn-sm" onclick="refreshGitHubLists()">
                            <i class="fa-solid fa-rotate me-1"></i> Actualizar
                        </button>
                    </div>
                    
                    <div id="githubListsContainer">
                        <div class="spinner-container">
                            <div class="spinner-border text-dark" role="status">
                                <span class="visually-hidden">Cargando listas...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noListsMessage" class="alert alert-info d-none">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        No hay listas guardadas en tu repositorio. Guarda una lista primero.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button id="loadSelectedBtn" class="btn btn-primary" onclick="loadSelectedList()" disabled>
                        <i class="fa-solid fa-download me-2"></i> Cargar lista seleccionada
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para guardar lista en GitHub -->
    <div class="modal fade" id="githubSaveModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">
                        <i class="fa-brands fa-github me-2"></i> Guardar lista en GitHub
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="listName" class="form-label">Nombre de la lista</label>
                        <input type="text" class="form-control" id="listName" 
                               placeholder="Mi lista de alumnos">
                        <div class="form-text">
                            Se guardará como: <span id="fileNamePreview" class="fw-bold">lista.json</span>
                        </div>
                    </div>
                    
                    <div id="existingListsWarning" class="alert alert-warning d-none">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        Ya existe una lista con este nombre. ¿Quieres sobrescribirla?
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Listas existentes</label>
                        <div id="existingLists" class="list-group" style="max-height: 200px; overflow-y: auto;">
                            <!-- Listas existentes aparecerán aquí -->
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        La lista se guardará en tu repositorio de GitHub y podrás acceder a ella desde cualquier dispositivo.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary" onclick="confirmSaveToGitHub()">
                        <i class="fa-solid fa-cloud-arrow-up me-2"></i> Guardar en GitHub
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar/eliminar lista -->
    <div class="modal fade" id="githubEditModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">
                        <i class="fa-brands fa-github me-2"></i> Gestionar lista
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editListSha">
                    
                    <div class="mb-3">
                        <label for="editListName" class="form-label">Nombre de la lista</label>
                        <input type="text" class="form-control" id="editListName">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Información</label>
                        <div class="card">
                            <div class="card-body">
                                <p class="mb-1"><strong>Archivo:</strong> <span id="editFileName"></span></p>
                                <p class="mb-1"><strong>Última modificación:</strong> <span id="editLastModified"></span></p>
                                <p class="mb-0"><strong>Número de elementos:</strong> <span id="editItemCount"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-danger" id="deleteWarning" style="display: none;">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        <strong>¡Atención!</strong> Esta acción eliminará permanentemente la lista del repositorio.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button id="deleteListBtn" class="btn btn-danger" onclick="deleteGitHubList()">
                        <i class="fa-solid fa-trash me-2"></i> Eliminar lista
                    </button>
                    <button id="updateListBtn" class="btn btn-primary" onclick="updateGitHubList()">
                        <i class="fa-solid fa-pen-to-square me-2"></i> Actualizar nombre
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de instrucciones de instalación -->
    <div class="modal fade install-modal" id="installModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header install-modal-header">
                    <h5 class="modal-title">
                        <i class="fa-solid fa-mobile-screen me-2"></i> Instalar Aplicación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Instala esta aplicación en tu dispositivo para usarla como una app nativa, incluso sin conexión a internet.</p>
                    
                    <div class="install-steps">
                        <div class="install-step">
                            <div class="install-step-icon">
                                <i class="fa-solid fa-1"></i>
                            </div>
                            <div>
                                <strong>Abre el menú de opciones</strong>
                                <p class="mb-0 small">Toca el botón de menú (⋮) en tu navegador</p>
                            </div>
                        </div>
                        
                        <div class="install-step">
                            <div class="install-step-icon">
                                <i class="fa-solid fa-2"></i>
                            </div>
                            <div>
                                <strong>Selecciona "Instalar app"</strong>
                                <p class="mb-0 small">Busca la opción "Instalar aplicación" o "Add to Home Screen"</p>
                            </div>
                        </div>
                        
                        <div class="install-step">
                            <div class="install-step-icon">
                                <i class="fa-solid fa-3"></i>
                            </div>
                            <div>
                                <strong>Confirma la instalación</strong>
                                <p class="mb-0 small">Sigue las instrucciones para completar la instalación</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button id="deferredInstallBtn" class="btn btn-primary w-100 d-none" onclick="installPWA()">
                            <i class="fa-solid fa-download me-2"></i> Instalar ahora
                        </button>
                        
                        <div class="alert alert-info mt-3 small">
                            <i class="fa-solid fa-info-circle me-2"></i>
                            Una vez instalada, la aplicación funcionará completamente offline y tendrá su propio icono en tu pantalla de inicio.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- Lógica de la Aplicación ---

        // Estado global
        let names = [];
        let githubConfig = null;
        let githubLists = [];
        let selectedList = null;

        // Referencias al DOM
        const nameInput = document.getElementById('nameInput');
        const nameList = document.getElementById('nameList');
        const countSpan = document.getElementById('count');
        const emptyState = document.getElementById('emptyState');
        const sortBtn = document.getElementById('sortBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultSection = document.getElementById('resultSection');
        const resultList = document.getElementById('resultList');
        const fileInput = document.getElementById('fileInput');
        const duplicateAlert = document.getElementById('duplicateAlert');
        const eliminarGanadorCheck = document.getElementById('eliminarGanadorCheck');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const appStatus = document.getElementById('appStatus');
        const installButton = document.getElementById('installButton');
        const deferredInstallBtn = document.getElementById('deferredInstallBtn');
        const versionInfo = document.getElementById('versionInfo');
        const saveToGitHubBtn = document.getElementById('saveToGitHubBtn');
        const loadFromGitHubBtn = document.getElementById('loadFromGitHubBtn');
        const tokenFileInput = document.getElementById('tokenFileInput');

        // Variables para PWA
        let deferredPrompt;
        const APP_VERSION = '1.1.0';

        // Inicializar versión
        versionInfo.textContent = `v${APP_VERSION} • Sorteo 100% aleatorio`;

        // Función para ordenar nombres alfabéticamente (insensible a mayúsculas/minúsculas)
        function sortNamesAlphabetically() {
            names.sort((a, b) => {
                return a.localeCompare(b, 'es', { sensitivity: 'base' });
            });
        }

        // Escuchar tecla "Enter" en el input
        nameInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                addName();
            }
        });

        // Escuchar cambio en el input de archivo
        fileInput.addEventListener('change', handleFileUpload);
        
        // Escuchar cambio en el input de archivo de token
        tokenFileInput.addEventListener('change', handleTokenFileUpload);

        // Función para manejar la subida de archivo de token
        function handleTokenFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const token = e.target.result.trim();
                document.getElementById('githubToken').value = token;
                updateTokenPreview(token);
                tokenFileInput.value = '';
            };
            reader.readAsText(file);
        }

        // Función para verificar si un nombre ya existe (insensible a mayúsculas/minúsculas)
        function isDuplicate(name) {
            return names.some(existingName => 
                existingName.toLowerCase().trim() === name.toLowerCase().trim()
            );
        }

        // Función para añadir nombre
        function addName() {
            const val = nameInput.value.trim();
            
            if (val) {
                // Verificar si es duplicado
                if (isDuplicate(val)) {
                    duplicateAlert.classList.remove('d-none');
                    setTimeout(() => {
                        duplicateAlert.classList.add('d-none');
                    }, 5000);
                    return;
                }
                
                addNamesToList([val]);
                nameInput.value = '';
                nameInput.focus();
            }
        }

        // Función auxiliar para añadir múltiples nombres y actualizar UI
        function addNamesToList(newNames) {
            // Filtrar vacíos y duplicados
            const validNames = newNames.filter(n => {
                const nameStr = String(n).trim();
                return nameStr && !isDuplicate(nameStr);
            });
            
            if (validNames.length > 0) {
                names = [...names, ...validNames];
                
                // Ordenar alfabéticamente
                sortNamesAlphabetically();
                
                renderList();
                
                // Si ya había resultados, los ocultamos
                if (!resultSection.classList.contains('d-none')) {
                    resetSort();
                }
                
                // Guardar en localStorage
                saveToStorage();
            }
        }

        // Función para guardar datos en localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('sorteo_nombres', JSON.stringify(names));
                localStorage.setItem('sorteo_eliminar_ganador', eliminarGanadorCheck.checked);
                localStorage.setItem('sorteo_version', APP_VERSION);
            } catch (e) {
                console.log('Error guardando datos:', e);
            }
        }

        // Función para cargar datos desde localStorage
        function loadFromStorage() {
            try {
                const savedNames = localStorage.getItem('sorteo_nombres');
                const savedEliminar = localStorage.getItem('sorteo_eliminar_ganador');
                const savedVersion = localStorage.getItem('sorteo_version');
                
                if (savedNames) {
                    names = JSON.parse(savedNames);
                    sortNamesAlphabetically();
                    renderList();
                }
                
                if (savedEliminar) {
                    eliminarGanadorCheck.checked = savedEliminar === 'true';
                }
                
                // Cargar configuración de GitHub
                loadGitHubConfig();
                
                // Si hay una versión anterior, podemos hacer migraciones aquí
                if (savedVersion && savedVersion !== APP_VERSION) {
                    console.log(`Actualizando de versión ${savedVersion} a ${APP_VERSION}`);
                }
            } catch (e) {
                console.log('Error cargando datos:', e);
            }
        }

        // Función para Exportar Lista
        function exportList(type) {
            if (names.length === 0) {
                showNotification('La lista está vacía. Añade nombres antes de exportar.', 'warning');
                return;
            }

            let content = '';
            let mimeType = '';
            let extension = '';

            if (type === 'json') {
                content = JSON.stringify(names, null, 2);
                mimeType = 'application/json';
                extension = 'json';
            } else {
                // TXT (separado por comas para que sea compatible con la importación)
                content = names.join(',');
                mimeType = 'text/plain';
                extension = 'txt';
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            // Crear enlace temporal y forzar descarga
            const a = document.createElement('a');
            const date = new Date().toISOString().slice(0, 10);
            a.href = url;
            a.download = `lista_sorteo_${date}.${extension}`;
            document.body.appendChild(a);
            a.click();
            
            // Limpieza
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Mostrar notificación
            showNotification(`Lista exportada correctamente (${names.length} nombres)`, 'success');
        }

        // Función para manejar la subida de archivos
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            const fileName = file.name.toLowerCase();

            reader.onload = function(e) {
                const data = e.target.result;
                let importedNames = [];

                try {
                    if (fileName.endsWith('.json')) {
                        // Lógica JSON
                        const json = JSON.parse(data);
                        if (Array.isArray(json)) {
                            // Asumimos array de strings ["Juan", "Ana"] o objetos [{name: "Juan"}]
                            importedNames = json.map(item => {
                                if (typeof item === 'object' && item !== null) {
                                    return Object.values(item)[0]; // Toma el primer valor del objeto
                                }
                                return item;
                            });
                        } else {
                            showNotification('El archivo JSON debe contener una lista (array).', 'warning');
                            return;
                        }

                    } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                        // Lógica Excel (SheetJS)
                        const workbook = XLSX.read(data, {type: 'binary'});
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        // Convertir a array de arrays
                        const rows = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        // Aplanar array y filtrar
                        importedNames = rows.flat();

                    } else {
                        // Lógica TXT / CSV (separado por comas o saltos de línea)
                        // Reemplazamos saltos de línea por comas para unificar el split
                        const textContent = data.replace(/(\r\n|\n|\r)/gm, ",");
                        importedNames = textContent.split(',');
                    }

                    // Limpieza final de los datos importados
                    importedNames = importedNames
                        .map(n => String(n).trim()) // Convertir a string y quitar espacios
                        .filter(n => n.length > 0); // Quitar vacíos

                    // Filtrar duplicados antes de agregar
                    const uniqueImportedNames = importedNames.filter(name => !isDuplicate(name));
                    
                    // Si hay duplicados, informar al usuario
                    if (uniqueImportedNames.length < importedNames.length) {
                        const duplicateCount = importedNames.length - uniqueImportedNames.length;
                        showNotification(
                            `Se importaron ${uniqueImportedNames.length} nombres. Se omitieron ${duplicateCount} duplicados.`,
                            'info'
                        );
                    }

                    if (uniqueImportedNames.length > 0) {
                        addNamesToList(uniqueImportedNames);
                        showNotification(`¡Se importaron ${uniqueImportedNames.length} nombres correctamente!`, 'success');
                    } else {
                        showNotification('No se encontraron nombres válidos en el archivo.', 'warning');
                    }

                } catch (error) {
                    console.error(error);
                    showNotification('Error al leer el archivo. Asegúrate de que el formato sea correcto.', 'danger');
                }
                
                // Limpiar input para permitir subir el mismo archivo de nuevo si es necesario
                fileInput.value = ''; 
            };

            if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                reader.readAsBinaryString(file);
            } else {
                reader.readAsText(file);
            }
        }

        // Función para borrar un nombre específico
        function removeName(index) {
            names.splice(index, 1);
            
            // Ordenar alfabéticamente después de eliminar
            sortNamesAlphabetically();
            
            renderList();
            saveToStorage();
            
            if (!resultSection.classList.contains('d-none')) {
                resetSort();
            }
        }

        // Función para borrar toda la lista
        function clearList() {
            if(confirm('¿Estás seguro de que quieres borrar toda la lista?')) {
                names = [];
                renderList();
                resetSort();
                saveToStorage();
            }
        }

        // Renderizar la lista de entrada
        function renderList() {
            nameList.innerHTML = '';
            countSpan.textContent = names.length;

            if (names.length === 0) {
                nameList.appendChild(emptyState);
                sortBtn.disabled = true;
                clearBtn.classList.add('d-none');
            } else {
                sortBtn.disabled = names.length < 2; 
                clearBtn.classList.remove('d-none');

                names.forEach((name, index) => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `
                        <div class="d-flex align-items-center overflow-hidden">
                            <span class="badge bg-primary rounded-circle me-3" style="width: 28px; height: 28px; line-height: 28px;">${index + 1}</span>
                            <span class="fw-medium text-truncate">${escapeHtml(name)}</span>
                        </div>
                        <button onclick="removeName(${index})" class="btn btn-link text-muted p-0">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    `;
                    nameList.appendChild(li);
                });
            }
        }

        // Función Principal: Ordenar Aleatoriamente (Algoritmo Fisher-Yates)
        function sortNames() {
            if (names.length < 2) return;

            let shuffled = [...names];
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            renderResults(shuffled);
            launchConfetti();
            
            // Si está activada la opción de eliminar ganador, eliminar el primer lugar
            if (eliminarGanadorCheck.checked && shuffled.length > 0) {
                const winner = shuffled[0];
                const indexToRemove = names.findIndex(name => 
                    name.toLowerCase().trim() === winner.toLowerCase().trim()
                );
                
                if (indexToRemove !== -1) {
                    names.splice(indexToRemove, 1);
                    
                    // Ordenar alfabéticamente después de eliminar
                    sortNamesAlphabetically();
                    
                    renderList();
                    saveToStorage();
                    
                    // Mostrar notificación que desaparece automáticamente después de 5 segundos
                    setTimeout(() => {
                        showNotification(`El ganador "${winner}" ha sido eliminado de la lista.`, 'info');
                    }, 500);
                }
            }
        }

        // Mostrar resultados
        function renderResults(sortedNames) {
            resultList.innerHTML = '';
            resultSection.classList.remove('d-none');
            
            setTimeout(() => {
                resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);

            sortedNames.forEach((name, index) => {
                let isWinner = index === 0;
                
                const li = document.createElement('li');
                li.className = `result-item p-3 rounded list-item-enter ${isWinner ? 'winner-item' : ''}`;
                li.style.animationDelay = `${index * 0.1}s`;
                
                li.innerHTML = `
                    <div class="d-flex align-items-center">
                        <span class="badge ${isWinner ? 'winner-badge' : 'bg-secondary'} rounded-circle me-3 d-flex align-items-center justify-content-center" 
                              style="width: 40px; height: 40px; font-size: 1.1rem;">
                            ${index + 1}
                        </span>
                        <div class="flex-grow-1">
                            <h5 class="mb-0 ${isWinner ? 'fw-bold text-warning' : 'fw-normal'}">
                                ${escapeHtml(name)} ${isWinner ? '<i class="fa-solid fa-crown ms-2"></i>' : ''}
                            </h5>
                            <small class="text-muted">Posición ${index + 1}</small>
                        </div>
                    </div>
                `;
                resultList.appendChild(li);
            });
        }

        function resetSort() {
            resultSection.classList.add('d-none');
            resultList.innerHTML = '';
        }

        function escapeHtml(text) {
            if (!text) return text;
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function launchConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var random = function(min, max) {
                return Math.random() * (max - min) + min;
            }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // Función para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'warning': 'alert-warning',
                'danger': 'alert-danger',
                'info': 'alert-info'
            }[type] || 'alert-info';

            const icon = {
                'success': 'fa-circle-check',
                'warning': 'fa-triangle-exclamation',
                'danger': 'fa-circle-exclamation',
                'info': 'fa-circle-info'
            }[type] || 'fa-circle-info';

            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} auto-dismiss-alert mt-3`;
            alertDiv.innerHTML = `
                <i class="fa-solid ${icon} me-2"></i>
                ${message}
            `;
            
            const container = document.querySelector('#listsContainer');
            container.insertBefore(alertDiv, container.firstChild);
            
            // Eliminar la alerta después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // --- Funcionalidades GitHub ---

        // Cargar configuración de GitHub desde localStorage
        function loadGitHubConfig() {
            try {
                const config = localStorage.getItem('github_config');
                if (config) {
                    githubConfig = JSON.parse(config);
                    
                    // Actualizar UI con la configuración cargada
                    document.getElementById('githubToken').value = githubConfig.token || '';
                    document.getElementById('githubUsername').value = githubConfig.username || '';
                    document.getElementById('githubRepo').value = githubConfig.repo || 'sorteo-listas';
                    document.getElementById('githubFolder').value = githubConfig.folder || 'listas';
                    
                    updateTokenPreview(githubConfig.token || '');
                    
                    // Mostrar botones de GitHub si hay configuración
                    if (githubConfig.token && githubConfig.username) {
                        saveToGitHubBtn.classList.remove('d-none');
                        loadFromGitHubBtn.classList.remove('d-none');
                        updateGitHubStatus('Configuración cargada correctamente', 'success');
                    } else {
                        updateGitHubStatus('Configuración incompleta', 'warning');
                    }
                } else {
                    updateGitHubStatus('No hay configuración de GitHub guardada', 'secondary');
                }
            } catch (e) {
                console.error('Error cargando configuración de GitHub:', e);
                updateGitHubStatus('Error cargando configuración', 'danger');
            }
        }

        // Guardar configuración de GitHub en localStorage
        function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim() || 'sorteo-listas';
            const folder = document.getElementById('githubFolder').value.trim() || 'listas';
            
            if (!token || !username) {
                showNotification('Por favor, introduce el token y nombre de usuario de GitHub.', 'warning');
                return;
            }
            
            githubConfig = {
                token,
                username,
                repo,
                folder,
                lastUpdated: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('github_config', JSON.stringify(githubConfig));
                updateTokenPreview(token);
                
                // Mostrar botones de GitHub
                saveToGitHubBtn.classList.remove('d-none');
                loadFromGitHubBtn.classList.remove('d-none');
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('githubConfigModal'));
                modal.hide();
                
                showNotification('Configuración de GitHub guardada correctamente.', 'success');
                updateGitHubStatus('Configuración guardada', 'success');
                
                // Probar conexión automáticamente
                setTimeout(testGitHubConnection, 500);
            } catch (e) {
                console.error('Error guardando configuración de GitHub:', e);
                showNotification('Error guardando configuración.', 'danger');
            }
        }

        // Limpiar configuración de GitHub
        function clearGitHubConfig() {
            if (confirm('¿Estás seguro de que quieres eliminar la configuración de GitHub?')) {
                localStorage.removeItem('github_config');
                githubConfig = null;
                
                // Limpiar formulario
                document.getElementById('githubToken').value = '';
                document.getElementById('githubUsername').value = '';
                document.getElementById('githubRepo').value = 'sorteo-listas';
                document.getElementById('githubFolder').value = 'listas';
                
                // Ocultar botones de GitHub
                saveToGitHubBtn.classList.add('d-none');
                loadFromGitHubBtn.classList.add('d-none');
                
                updateTokenPreview('');
                updateGitHubStatus('Configuración eliminada', 'info');
                showNotification('Configuración de GitHub eliminada.', 'info');
            }
        }

        // Actualizar vista previa del token
        function updateTokenPreview(token) {
            const tokenPreview = document.getElementById('tokenPreview');
            if (token) {
                // Mostrar solo los primeros y últimos caracteres
                const preview = token.length > 10 
                    ? `${token.substring(0, 4)}...${token.substring(token.length - 4)}`
                    : '••••••••';
                tokenPreview.textContent = preview;
                tokenPreview.classList.remove('d-none');
            } else {
                tokenPreview.classList.add('d-none');
            }
        }

        // Alternar visibilidad del token
        function toggleTokenVisibility() {
            const tokenInput = document.getElementById('githubToken');
            const eyeIcon = tokenInput.parentElement.querySelector('.fa-eye');
            const eyeSlashIcon = tokenInput.parentElement.querySelector('.fa-eye-slash');
            
            if (tokenInput.type === 'password') {
                tokenInput.type = 'text';
                eyeIcon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                tokenInput.type = 'password';
                eyeIcon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        // Actualizar estado de GitHub en la UI
        function updateGitHubStatus(message, type = 'secondary') {
            const statusElement = document.getElementById('githubStatus');
            const icon = {
                'success': 'fa-circle-check',
                'warning': 'fa-triangle-exclamation',
                'danger': 'fa-circle-exclamation',
                'info': 'fa-circle-info',
                'secondary': 'fa-circle-question'
            }[type] || 'fa-circle-question';
            
            statusElement.className = `alert alert-${type}`;
            statusElement.innerHTML = `<i class="fa-solid ${icon} me-2"></i>${message}`;
        }

        // Probar conexión con GitHub
        async function testGitHubConnection() {
            if (!githubConfig || !githubConfig.token || !githubConfig.username) {
                showNotification('Configura primero el token y nombre de usuario de GitHub.', 'warning');
                return;
            }
            
            updateGitHubStatus('Probando conexión con GitHub...', 'info');
            
            try {
                const response = await fetch(`https://api.github.com/user`, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    updateGitHubStatus(`Conectado como ${userData.login}`, 'success');
                    
                    // Verificar si el repositorio existe
                    const repoResponse = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}`, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (repoResponse.ok) {
                        showNotification(`Conexión exitosa. Repositorio "${githubConfig.repo}" encontrado.`, 'success');
                    } else if (repoResponse.status === 404) {
                        updateGitHubStatus(`Repositorio "${githubConfig.repo}" no encontrado. ¿Quieres crearlo?`, 'warning');
                        if (confirm(`El repositorio "${githubConfig.repo}" no existe. ¿Quieres crearlo?`)) {
                            createGitHubRepo();
                        }
                    } else {
                        updateGitHubStatus(`Error accediendo al repositorio: ${repoResponse.statusText}`, 'danger');
                    }
                } else {
                    updateGitHubStatus(`Error de autenticación: ${response.statusText}`, 'danger');
                }
            } catch (error) {
                console.error('Error probando conexión con GitHub:', error);
                updateGitHubStatus('Error de conexión. Verifica tu token y conexión a internet.', 'danger');
            }
        }

        // Crear repositorio en GitHub
        async function createGitHubRepo() {
            if (!githubConfig) return;
            
            try {
                const response = await fetch(`https://api.github.com/user/repos`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: githubConfig.repo,
                        description: 'Listas de sorteos aleatorios',
                        private: true,
                        auto_init: true
                    })
                });
                
                if (response.ok) {
                    showNotification(`Repositorio "${githubConfig.repo}" creado exitosamente.`, 'success');
                    updateGitHubStatus('Repositorio creado correctamente', 'success');
                } else {
                    const error = await response.json();
                    showNotification(`Error creando repositorio: ${error.message}`, 'danger');
                }
            } catch (error) {
                console.error('Error creando repositorio:', error);
                showNotification('Error creando repositorio.', 'danger');
            }
        }

        // Mostrar modal de configuración de GitHub
        function showGitHubConfig() {
            const modal = new bootstrap.Modal(document.getElementById('githubConfigModal'));
            modal.show();
        }

        // Cargar listas desde GitHub
        async function loadFromGitHub() {
            if (!githubConfig) {
                showNotification('Configura primero GitHub en el menú de configuración.', 'warning');
                showGitHubConfig();
                return;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('githubLoadModal'));
            modal.show();
            
            await fetchGitHubLists();
        }

        // Obtener listas desde GitHub
        async function fetchGitHubLists() {
            if (!githubConfig) return;
            
            const listsContainer = document.getElementById('githubListsContainer');
            const noListsMessage = document.getElementById('noListsMessage');
            const repoInfo = document.getElementById('repoInfo');
            
            listsContainer.innerHTML = `
                <div class="spinner-container">
                    <div class="spinner-border text-dark" role="status">
                        <span class="visually-hidden">Cargando listas...</span>
                    </div>
                </div>
            `;
            noListsMessage.classList.add('d-none');
            repoInfo.textContent = `Cargando listas de ${githubConfig.username}/${githubConfig.repo}...`;
            
            try {
                // Obtener contenido de la carpeta
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${githubConfig.folder}`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    const contents = await response.json();
                    
                    // Filtrar solo archivos JSON
                    githubLists = contents.filter(item => 
                        item.type === 'file' && item.name.endsWith('.json')
                    );
                    
                    repoInfo.textContent = `${githubConfig.username}/${githubConfig.repo} (${githubLists.length} listas)`;
                    
                    if (githubLists.length === 0) {
                        listsContainer.innerHTML = '';
                        noListsMessage.classList.remove('d-none');
                    } else {
                        renderGitHubLists();
                    }
                } else if (response.status === 404) {
                    // La carpeta no existe
                    listsContainer.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fa-solid fa-folder me-2"></i>
                            La carpeta "${githubConfig.folder}" no existe en el repositorio.
                        </div>
                    `;
                    repoInfo.textContent = `${githubConfig.username}/${githubConfig.repo} (0 listas)`;
                } else {
                    const error = await response.json();
                    listsContainer.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fa-solid fa-circle-exclamation me-2"></i>
                            Error cargando listas: ${error.message || response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error obteniendo listas de GitHub:', error);
                listsContainer.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fa-solid fa-circle-exclamation me-2"></i>
                        Error de conexión: ${error.message}
                    </div>
                `;
            }
        }

        // Renderizar listas de GitHub en el modal
        function renderGitHubLists() {
            const listsContainer = document.getElementById('githubListsContainer');
            listsContainer.innerHTML = '';
            
            githubLists.forEach((list, index) => {
                const listDate = new Date(list.last_modified || list.updated_at || list.created_at);
                const formattedDate = listDate.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const listItem = document.createElement('div');
                listItem.className = `github-list-item list-group-item list-group-item-action d-flex justify-content-between align-items-center ${selectedList === list.name ? 'selected' : ''}`;
                listItem.dataset.name = list.name;
                listItem.dataset.sha = list.sha;
                listItem.dataset.index = index;
                
                listItem.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <input class="form-check-input" type="radio" name="githubList" ${selectedList === list.name ? 'checked' : ''}>
                        </div>
                        <div>
                            <h6 class="mb-1">${list.name.replace('.json', '')}</h6>
                            <small class="text-muted">
                                <i class="fa-solid fa-calendar me-1"></i>${formattedDate} • 
                                <i class="fa-solid fa-file-code ms-2 me-1"></i>${(list.size / 1024).toFixed(2)} KB
                            </small>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-1" onclick="editGitHubList('${list.name}', '${list.sha}', ${index}, event)">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                    </div>
                `;
                
                listItem.addEventListener('click', (e) => {
                    if (!e.target.closest('button')) {
                        selectGitHubList(list.name, index);
                    }
                });
                
                listsContainer.appendChild(listItem);
            });
            
            // Actualizar botón de carga
            document.getElementById('loadSelectedBtn').disabled = !selectedList;
        }

        // Seleccionar lista de GitHub
        function selectGitHubList(listName, index) {
            selectedList = listName;
            
            // Actualizar selección visual
            document.querySelectorAll('.github-list-item').forEach(item => {
                item.classList.remove('selected');
                const radio = item.querySelector('input[type="radio"]');
                if (radio) radio.checked = false;
            });
            
            const selectedItem = document.querySelector(`.github-list-item[data-name="${listName}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
                const radio = selectedItem.querySelector('input[type="radio"]');
                if (radio) radio.checked = true;
            }
            
            document.getElementById('loadSelectedBtn').disabled = false;
        }

        // Editar lista de GitHub
        function editGitHubList(listName, sha, index, event) {
            if (event) event.stopPropagation();
            
            const list = githubLists[index];
            const modal = new bootstrap.Modal(document.getElementById('githubEditModal'));
            
            document.getElementById('editListName').value = listName.replace('.json', '');
            document.getElementById('editListSha').value = sha;
            document.getElementById('editFileName').textContent = listName;
            
            const listDate = new Date(list.last_modified || list.updated_at || list.created_at);
            document.getElementById('editLastModified').textContent = listDate.toLocaleString('es-ES');
            
            // Obtener información de la lista para saber cuántos elementos tiene
            fetchListContent(list.download_url).then(content => {
                try {
                    const data = JSON.parse(content);
                    document.getElementById('editItemCount').textContent = Array.isArray(data) ? data.length : 'N/A';
                } catch {
                    document.getElementById('editItemCount').textContent = 'N/A';
                }
            }).catch(() => {
                document.getElementById('editItemCount').textContent = 'N/A';
            });
            
            modal.show();
        }

        // Obtener contenido de una lista
        async function fetchListContent(url) {
            try {
                const response = await fetch(url);
                if (response.ok) {
                    return await response.text();
                }
                throw new Error('Error obteniendo contenido');
            } catch (error) {
                console.error('Error obteniendo contenido de lista:', error);
                throw error;
            }
        }

        // Actualizar lista en GitHub
        async function updateGitHubList() {
            const newName = document.getElementById('editListName').value.trim();
            const sha = document.getElementById('editListSha').value;
            
            if (!newName) {
                showNotification('Por favor, introduce un nombre para la lista.', 'warning');
                return;
            }
            
            const oldFileName = document.getElementById('editFileName').textContent;
            const newFileName = `${newName}.json`;
            
            if (oldFileName === newFileName) {
                showNotification('El nombre no ha cambiado.', 'info');
                return;
            }
            
            try {
                // Obtener el contenido actual del archivo
                const list = githubLists.find(l => l.name === oldFileName);
                if (!list) {
                    throw new Error('Lista no encontrada');
                }
                
                const content = await fetchListContent(list.download_url);
                
                // Crear nuevo archivo
                const createResponse = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${githubConfig.folder}/${newFileName}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Renombrar lista: ${oldFileName} → ${newFileName}`,
                            content: btoa(unescape(encodeURIComponent(content))),
                            sha: null // Nuevo archivo
                        })
                    }
                );
                
                if (createResponse.ok) {
                    // Eliminar archivo antiguo
                    await fetch(
                        `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${githubConfig.folder}/${oldFileName}`,
                        {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `token ${githubConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `Eliminar lista antigua: ${oldFileName}`,
                                sha: sha
                            })
                        }
                    );
                    
                    showNotification(`Lista renombrada a "${newName}"`, 'success');
                    
                    // Cerrar modal y actualizar listas
                    const modal = bootstrap.Modal.getInstance(document.getElementById('githubEditModal'));
                    modal.hide();
                    
                    await fetchGitHubLists();
                } else {
                    const error = await createResponse.json();
                    throw new Error(error.message || 'Error renombrando lista');
                }
            } catch (error) {
                console.error('Error actualizando lista:', error);
                showNotification(`Error actualizando lista: ${error.message}`, 'danger');
            }
        }

        // Eliminar lista de GitHub
        async function deleteGitHubList() {
            const fileName = document.getElementById('editFileName').textContent;
            const sha = document.getElementById('editListSha').value;
            
            if (!confirm(`¿Estás seguro de que quieres eliminar permanentemente la lista "${fileName}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${githubConfig.folder}/${fileName}`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Eliminar lista: ${fileName}`,
                            sha: sha
                        })
                    }
                );
                
                if (response.ok) {
                    showNotification(`Lista "${fileName}" eliminada correctamente.`, 'success');
                    
                    // Cerrar modal y actualizar listas
                    const modal = bootstrap.Modal.getInstance(document.getElementById('githubEditModal'));
                    modal.hide();
                    
                    await fetchGitHubLists();
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Error eliminando lista');
                }
            } catch (error) {
                console.error('Error eliminando lista:', error);
                showNotification(`Error eliminando lista: ${error.message}`, 'danger');
            }
        }

        // Cargar lista seleccionada desde GitHub
        async function loadSelectedList() {
            if (!selectedList || !githubConfig) return;
            
            try {
                const list = githubLists.find(l => l.name === selectedList);
                if (!list) {
                    throw new Error('Lista no encontrada');
                }
                
                const content = await fetchListContent(list.download_url);
                const importedNames = JSON.parse(content);
                
                if (Array.isArray(importedNames) && importedNames.length > 0) {
                    // Preguntar si reemplazar o añadir
                    let action = 'replace';
                    if (names.length > 0) {
                        action = await new Promise(resolve => {
                            const modalContent = `
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Cargar lista desde GitHub</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>¿Qué quieres hacer con la lista "${selectedList.replace('.json', '')}" (${importedNames.length} nombres)?</p>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="loadAction" id="replaceAction" value="replace" checked>
                                            <label class="form-check-label" for="replaceAction">
                                                Reemplazar lista actual
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="loadAction" id="addAction" value="add">
                                            <label class="form-check-label" for="addAction">
                                                Añadir a la lista actual
                                            </label>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-primary" onclick="window.loadActionConfirmed = true; window.selectedLoadAction = document.querySelector('input[name=\"loadAction\"]:checked').value;">Continuar</button>
                                    </div>
                                </div>
                            `;
                            
                            const modalDiv = document.createElement('div');
                            modalDiv.className = 'modal fade';
                            modalDiv.innerHTML = modalContent;
                            document.body.appendChild(modalDiv);
                            
                            const modalInstance = new bootstrap.Modal(modalDiv);
                            modalInstance.show();
                            
                            modalDiv.addEventListener('hidden.bs.modal', () => {
                                if (window.loadActionConfirmed) {
                                    resolve(window.selectedLoadAction);
                                } else {
                                    resolve(null);
                                }
                                document.body.removeChild(modalDiv);
                                delete window.loadActionConfirmed;
                                delete window.selectedLoadAction;
                            });
                        });
                        
                        if (!action) return;
                    }
                    
                    if (action === 'replace') {
                        names = [];
                    }
                    
                    addNamesToList(importedNames);
                    
                    // Cerrar modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('githubLoadModal'));
                    modal.hide();
                    
                    showNotification(`Lista "${selectedList.replace('.json', '')}" cargada correctamente (${importedNames.length} nombres).`, 'success');
                    selectedList = null;
                } else {
                    throw new Error('La lista está vacía o tiene un formato incorrecto');
                }
            } catch (error) {
                console.error('Error cargando lista:', error);
                showNotification(`Error cargando lista: ${error.message}`, 'danger');
            }
        }

        // Actualizar listas de GitHub
        function refreshGitHubLists() {
            selectedList = null;
            fetchGitHubLists();
        }

        // Guardar lista en GitHub
        function saveToGitHub() {
            if (!githubConfig) {
                showNotification('Configura primero GitHub en el menú de configuración.', 'warning');
                showGitHubConfig();
                return;
            }
            
            if (names.length === 0) {
                showNotification('La lista está vacía. Añade nombres antes de guardar en GitHub.', 'warning');
                return;
            }
            
            // Cargar nombres de listas existentes
            loadExistingListsForSave();
            
            const modal = new bootstrap.Modal(document.getElementById('githubSaveModal'));
            modal.show();
            
            // Actualizar vista previa del nombre del archivo
            updateFileNamePreview();
        }

        // Cargar listas existentes para el modal de guardar
        async function loadExistingListsForSave() {
            if (!githubConfig) return;
            
            const existingListsContainer = document.getElementById('existingLists');
            existingListsContainer.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm" role="status"></div></div>';
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${githubConfig.folder}`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    const contents = await response.json();
                    const jsonFiles = contents.filter(item => 
                        item.type === 'file' && item.name.endsWith('.json')
                    );
                    
                    existingListsContainer.innerHTML = '';
                    
                    if (jsonFiles.length === 0) {
                        existingListsContainer.innerHTML = '<div class="text-center py-3 text-muted">No hay listas guardadas</div>';
                    } else {
                        jsonFiles.forEach(file => {
                            const listItem = document.createElement('a');
                            listItem.href = '#';
                            listItem.className = 'list-group-item list-group-item-action';
                            listItem.textContent = file.name.replace('.json', '');
                            listItem.onclick = (e) => {
                                e.preventDefault();
                                document.getElementById('listName').value = file.name.replace('.json', '');
                                updateFileNamePreview();
                                document.getElementById('existingListsWarning').classList.remove('d-none');
                            };
                            existingListsContainer.appendChild(listItem);
                        });
                    }
                } else if (response.status === 404) {
                    existingListsContainer.innerHTML = '<div class="text-center py-3 text-muted">La carpeta no existe</div>';
                }
            } catch (error) {
                console.error('Error cargando listas existentes:', error);
                existingListsContainer.innerHTML = '<div class="text-center py-3 text-danger">Error cargando listas</div>';
            }
        }

        // Actualizar vista previa del nombre del archivo
        function updateFileNamePreview() {
            const listName = document.getElementById('listName').value.trim();
            const fileName = listName ? `${listName}.json` : 'lista.json';
            document.getElementById('fileNamePreview').textContent = fileName;
        }

        // Confirmar guardado en GitHub
        async function confirmSaveToGitHub() {
            const listName = document.getElementById('listName').value.trim() || 'lista';
            const fileName = `${listName}.json`;
            const filePath = `${githubConfig.folder}/${fileName}`;
            
            // Verificar si el archivo ya existe
            let fileExists = false;
            let existingSha = null;
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${filePath}`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    const fileInfo = await response.json();
                    fileExists = true;
                    existingSha = fileInfo.sha;
                }
            } catch (error) {
                // El archivo no existe, continuar
            }
            
            // Si el archivo existe, preguntar si sobrescribir
            if (fileExists && !confirm(`¿Sobrescribir la lista existente "${listName}"?`)) {
                return;
            }
            
            // Guardar en GitHub
            await saveListToGitHub(fileName, filePath, existingSha);
        }

        // Guardar lista en GitHub
        async function saveListToGitHub(fileName, filePath, existingSha = null) {
            try {
                const content = JSON.stringify(names, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: existingSha 
                                ? `Actualizar lista: ${fileName}` 
                                : `Guardar lista: ${fileName}`,
                            content: encodedContent,
                            sha: existingSha || undefined
                        })
                    }
                );
                
                if (response.ok) {
                    showNotification(`Lista guardada en GitHub como "${fileName.replace('.json', '')}"`, 'success');
                    
                    // Cerrar modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('githubSaveModal'));
                    modal.hide();
                    
                    // Limpiar formulario
                    document.getElementById('listName').value = '';
                    document.getElementById('existingListsWarning').classList.add('d-none');
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Error guardando lista');
                }
            } catch (error) {
                console.error('Error guardando lista en GitHub:', error);
                showNotification(`Error guardando lista: ${error.message}`, 'danger');
            }
        }

        // --- Funcionalidades PWA ---

        // Mostrar instrucciones de instalación
        function showInstallInstructions() {
            const modal = new bootstrap.Modal(document.getElementById('installModal'));
            modal.show();
        }

        // Instalar PWA
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usuario aceptó la instalación');
                        showNotification('¡Aplicación instalada correctamente!', 'success');
                        installButton.classList.add('d-none');
                        deferredInstallBtn.classList.add('d-none');
                    } else {
                        console.log('Usuario rechazó la instalación');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Detectar cambios en la conexión
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            if (isOnline) {
                offlineIndicator.classList.remove('show');
                appStatus.innerHTML = '<i class="fa-solid fa-circle me-1" style="font-size: 0.6rem;"></i> Online';
                appStatus.className = 'badge bg-success bg-opacity-75';
            } else {
                offlineIndicator.classList.add('show');
                appStatus.innerHTML = '<i class="fa-solid fa-circle me-1" style="font-size: 0.6rem;"></i> Offline';
                appStatus.className = 'badge bg-danger bg-opacity-75';
            }
        }

        // Registrar Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('service-worker.js')
                        .then(registration => {
                            console.log('ServiceWorker registrado con éxito:', registration.scope);
                            
                            // Verificar actualizaciones
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        showNotification('¡Nueva versión disponible! Recarga la página para actualizar.', 'info');
                                    }
                                });
                            });
                        })
                        .catch(error => {
                            console.log('Error al registrar ServiceWorker:', error);
                        });
                });
            }
        }

        // Inicializar la aplicación
        function initApp() {
            // Cargar datos guardados
            loadFromStorage();
            
            // Configurar eventos de conexión
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
            
            // Registrar Service Worker
            registerServiceWorker();
            
            // Evento para instalación de PWA
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Mostrar botón de instalación si no está ya instalado
                if (!window.matchMedia('(display-mode: standalone)').matches) {
                    installButton.classList.remove('d-none');
                    deferredInstallBtn.classList.remove('d-none');
                }
            });
            
            // Ocultar botón de instalación si ya está instalado
            if (window.matchMedia('(display-mode: standalone)').matches) {
                installButton.classList.add('d-none');
            }
            
            // Evento cuando la app se instala
            window.addEventListener('appinstalled', () => {
                console.log('Aplicación instalada');
                installButton.classList.add('d-none');
                deferredInstallBtn.classList.add('d-none');
                deferredPrompt = null;
            });
            
            // Guardar automáticamente cuando cambia el checkbox
            eliminarGanadorCheck.addEventListener('change', saveToStorage);
            
            // Actualizar vista previa del nombre del archivo
            document.getElementById('listName').addEventListener('input', updateFileNamePreview);
        }

        // Inicializar cuando se carga el DOM
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>